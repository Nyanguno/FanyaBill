<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FanyaBill App - AI Business Assistant</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.paypal.com/sdk/js?client-id=AVetgrGryV2vI9648Mi4ht0JhoOn599N4W706O0yxuo33KaC0dJFa_U2xxSUt1aqelv3QnHwpNs_4hU5&currency=USD"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="api-config.js"></script>
</head>
<body class="app-body">
    <header class="app-header">
        <div class="app-nav">
            <div class="app-logo">
                <img src="images/logo.png" alt="FanyaBill Logo" style="height: 40px; margin-right: 10px;">
                <span>FanyaBill</span>
            </div>
            <div class="app-status">
                <div id="invoiceStatus" class="invoice-counter">
                    <i class="fas fa-file-invoice"></i>
                    <span id="invoiceCount">0</span> / <span id="invoiceLimit">3</span> invoices
                </div>
                <div id="proBanner" class="pro-banner" style="display: none;">
                    <i class="fas fa-crown"></i>
                    Pro Unlocked
                </div>
                <button id="upgradeBtn" class="btn-upgrade" onclick="showUpgradeModal()" style="display: none;">
                    <i class="fas fa-star"></i>
                    Upgrade to Pro
                </button>
            </div>
        </div>
    </header>

    <div class="app-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#invoice" class="nav-item" onclick="showSection('invoice')">
                    <i class="fas fa-file-invoice"></i>
                    Generate Invoice
                </a>
                <a href="#inventory" class="nav-item" onclick="showSection('inventory')">
                    <i class="fas fa-boxes"></i>
                    Inventory
                </a>
                <a href="#sales" class="nav-item" onclick="showSection('sales')">
                    <i class="fas fa-chart-line"></i>
                    Sales Summary
                </a>
                <a href="#chat" class="nav-item" onclick="showSection('chat')">
                    <i class="fas fa-robot"></i>
                    FanyaBot
                </a>
                <a href="#settings" class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1>Dashboard</h1>
                    <p>Welcome to your AI-powered business assistant</p>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="card-content">
                            <h3>Invoices Generated</h3>
                            <div class="card-value" id="dashboardInvoiceCount">0</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="card-content">
                            <h3>Total Revenue</h3>
                            <div class="card-value" id="dashboardRevenue">$0</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="card-content">
                            <h3>Products in Stock</h3>
                            <div class="card-value" id="dashboardProducts">0</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="card-content">
                            <h3>Low Stock Items</h3>
                            <div class="card-value" id="dashboardLowStock">0</div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="showSection('invoice')">
                            <i class="fas fa-plus"></i>
                            Generate Invoice
                        </button>
                        <button class="action-btn" onclick="showSection('inventory')">
                            <i class="fas fa-box"></i>
                            Add Product
                        </button>
                        <button class="action-btn" onclick="showSection('sales')">
                            <i class="fas fa-chart-bar"></i>
                            View Sales
                        </button>
                    </div>
                </div>
            </section>

            <section id="invoice" class="content-section">
                <div class="section-header">
                    <h1>Generate Invoice</h1>
                    <p>Describe your sale in natural language and let AI create a professional invoice</p>
                </div>

                <div class="invoice-generator">
                    <div class="input-section">
                        <label for="saleDescription">Describe your sale:</label>
                        <textarea 
                            id="saleDescription" 
                            placeholder="Example: 2kg rice at 150, 3 sugar at 120, 1 cooking oil at 200"
                            rows="4"
                        ></textarea>
                        <button id="generateBtn" class="btn-primary" onclick="generateInvoice()">
                            <i class="fas fa-magic"></i>
                            Generate Invoice
                        </button>
                    </div>

                    <div id="invoicePreview" class="invoice-preview" style="display: none;">
                        <div class="invoice-header">
                            <div class="invoice-title">
                                <h2>INVOICE</h2>
                                <div class="invoice-details">
                                    <div class="invoice-number">Invoice #<span id="invoiceNumber"></span></div>
                                    <div class="invoice-date">Date: <span id="invoiceDate"></span></div>
                                    <div class="invoice-due-date">Due Date: <span id="invoiceDueDate"></span></div>
                                </div>
                            </div>
                        </div>

                        <div class="invoice-parties">
                            <div class="invoice-from">
                                <h3>From:</h3>
                                <div id="businessInfo">
                                    <div id="businessName">Your Business</div>
                                    <div id="businessAddress">Business Address</div>
                                    <div id="businessCity">City, Country</div>
                                    <div id="businessPhone">Tel: N/A</div>
                                </div>
                            </div>
                            <div class="invoice-to">
                                <h3>To:</h3>
                                <div id="customerInfo">
                                    <div id="customerName">Customer Name</div>
                                    <div id="customerAddress">Customer Address</div>
                                    <div id="customerPhone">Tel: N/A</div>
                                </div>
                            </div>
                        </div>

                        <div class="invoice-items">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Unit Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceItemsTable">
                                    </tbody>
                            </table>
                        </div>

                        <div class="invoice-total-summary">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="invoiceSubtotal">$0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Tax (<span id="taxRateDisplay">0</span>%):</span>
                                <span id="invoiceTax">$0.00</span>
                            </div>
                            <div class="total-row final-total">
                                <span>TOTAL AMOUNT:</span>
                                <span id="invoiceTotal">$0.00</span>
                            </div>
                        </div>

                        <div class="invoice-note">
                            <p id="invoicePaymentNote">Note: Please pay it in the next 10 days as per the shop's rules.</p>
                        </div>
                        
                        <div class="invoice-powered-by">
                            <p>Powered by FanyaBill</p>
                        </div>

                        <div class="invoice-actions">
                            <button class="btn-primary" onclick="downloadInvoicePDF()">
                                <i class="fas fa-download"></i>
                                Download PDF
                            </button>
                            <button class="btn-secondary" onclick="clearInvoice()">
                                <i class="fas fa-trash"></i>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="inventory" class="content-section">
                <div class="section-header">
                    <h1>Inventory Management</h1>
                    <p>Add, edit, and track your products and stock levels</p>
                </div>

                <div class="inventory-controls">
                    <button class="btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i>
                        Add Product
                    </button>
                    <button class="btn-secondary" onclick="exportInventory()">
                        <i class="fas fa-download"></i>
                        Export CSV
                    </button>
                    <input type="file" id="importFile" accept=".csv" style="display: none;" onchange="importInventory()">
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">
                        <i class="fas fa-upload"></i>
                        Import CSV
                    </button>
                </div>

                <div class="inventory-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <tr class="empty-state">
                                <td colspan="5">
                                    <div class="empty-message">
                                        <i class="fas fa-box-open"></i>
                                        <p>No products added yet. Click "Add Product" to get started.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="sales" class="content-section">
                <div class="section-header">
                    <h1>Sales Summary</h1>
                    <p>Track your sales performance and top-selling products</p>
                </div>

                <div class="sales-overview">
                    <div class="sales-card">
                        <h3>Total Sales</h3>
                        <div class="sales-value" id="totalSales">$0.00</div>
                    </div>
                    <div class="sales-card">
                        <h3>Items Sold</h3>
                        <div class="sales-value" id="totalItemsSold">0</div>
                    </div>
                    <div class="sales-card">
                        <h3>Average Sale</h3>
                        <div class="sales-value" id="averageSale">$0.00</div>
                    </div>
                </div>

                <div class="sales-filters">
                    <button class="filter-btn active" onclick="filterSales('daily')">Daily</button>
                    <button class="filter-btn" onclick="filterSales('weekly')">Weekly</button>
                    <button class="filter-btn" onclick="filterSales('monthly')">Monthly</button>
                    <button class="filter-btn" onclick="filterSales('annually')">Annually</button>
                </div>

                <div class="top-products">
                    <h2>Top Selling Products</h2>
                    <div id="topProductsList" class="products-list">
                        <div class="empty-message">
                            <i class="fas fa-chart-line"></i>
                            <p>No sales data yet. Generate some invoices to see your top products!</p>
                        </div>
                    </div>
                </div>

                <h2>Sales History</h2>
                <div class="sales-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <tr class="empty-state">
                                <td colspan="6">
                                    <div class="empty-message">
                                        <i class="fas fa-history"></i>
                                        <p>No sales history yet. Generate invoices to populate this section.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="chat" class="content-section">
                <div class="section-header">
                    <h1>FanyaBot Assistant</h1>
                    <p>AI assistant to help answer customer questions about your inventory</p>
                </div>

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="bot-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <p>Hello! I'm FanyaBot, your AI assistant. I can help answer questions about your inventory. Try asking me something like "Do you have rice?" or "How much is cooking oil?"</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Ask about your inventory..." onkeypress="handleChatKeyPress(event)">
                        <button onclick="sendChatMessage()" class="btn-primary">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>

            <section id="settings" class="content-section">
                <div class="section-header">
                    <h1>Settings</h1>
                    <p>Configure your business information and preferences</p>
                </div>

                <div class="settings-form">
                    <div class="form-group">
                        <label for="businessNameInput">Business Name</label>
                        <input type="text" id="businessNameInput" placeholder="Your Business Name">
                    </div>
                    <div class="form-group">
                        <label for="businessAddressInput">Business Address</label>
                        <input type="text" id="businessAddressInput" placeholder="123 Business Street">
                    </div>
                    <div class="form-group">
                        <label for="businessCityInput">City</label>
                        <input type="text" id="businessCityInput" placeholder="City, Country">
                    </div>
                    <div class="form-group">
                        <label for="businessPhoneInput">Business Phone Number</label>
                        <input type="tel" id="businessPhoneInput" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label for="currencySelect">Currency</label>
                        <select id="currencySelect">
                            <option value="$">USD ($)</option>
                            <option value="€">EUR (€)</option>
                            <option value="£">GBP (£)</option>
                            <option value="KES">KES</option>
                            <option value="₹">INR (₹)</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="taxRateInput">Default Tax Rate (%)</label>
                        <input type="number" id="taxRateInput" placeholder="0" min="0" max="100" step="0.1">
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i>
                        Save Settings
                    </button>
                </div>
            </section>
        </main>
    </div>

    <div id="addProductModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Product</h2>
                <button class="modal-close" onclick="hideAddProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" placeholder="e.g., Rice 2kg">
                </div>
                <div class="form-group">
                    <label for="productPrice">Price</label>
                    <input type="number" id="productPrice" placeholder="0.00" step="0.01">
                </div>
                <div class="form-group">
                    <label for="productStock">Stock Quantity</label>
                    <input type="number" id="productStock" placeholder="0" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="hideAddProductModal()">Cancel</button>
                <button class="btn-primary" onclick="addProduct()">Add Product</button>
            </div>
        </div>
    </div>

    <div id="upgradeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🚀 Upgrade to FanyaBill Pro</h2>
                <button class="modal-close" onclick="hideUpgradeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Get unlimited invoices and premium features for just $7.99/month</p>
                <div class="upgrade-features">
                    <div class="feature">✅ Unlimited invoice generation</div>
                    <div class="feature">✅ Advanced analytics</div>
                    <div class="feature">✅ Priority support</div>
                    <div class="feature">✅ Future premium features</div>
                </div>
                <div id="paypal-button-container"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="hideUpgradeModal()">Maybe Later</button>
            </div>
        </div>
    </div>

    <div id="messageModal" class="modal" style="display: none;">
        <div class="modal-content">\
            <div class="modal-header">
                <h2 id="messageTitle">Message</h2>
                <button class="modal-close" onclick="hideMessageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="messageText"></p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="hideMessageModal()">OK</button>
            </div>
        </div>
    </div>

    <div id="lowStockAlert" class="alert" style="display: none;">
        <div class="alert-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="lowStockMessage"></span>
            <button onclick="hideLowStockAlert()">&times;</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
