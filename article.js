// Article content data
const articleContent = {
    'free-invoice-templates': {
        title: 'Free Invoice Templates: Create Professional Invoices in Minutes',
        description: 'Discover how free invoice templates can transform your billing process and help you create professional invoices that get paid faster.',
        image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
        content: `
            <h2>Why Free Invoice Templates Are Essential for Your Business</h2>
            <p>In today's competitive business landscape, professional invoicing is crucial for maintaining cash flow and building trust with clients. Free invoice templates provide an accessible solution for businesses of all sizes to create polished, professional invoices without the need for expensive software or design expertise.</p>
            
            <h3>The Power of Professional Invoicing</h3>
            <p>Professional invoices do more than just request payment – they reinforce your brand identity, demonstrate attention to detail, and can significantly impact how quickly you get paid. Studies show that well-designed invoices are paid 30% faster than basic, text-only invoices.</p>
            
            <blockquote>
                "A professional invoice is often the last impression you make on a client. Make it count." - Business Finance Expert
            </blockquote>
            
            <h3>Key Benefits of Using Invoice Templates</h3>
            <p>Free invoice templates offer numerous advantages for businesses:</p>
            <ul>
                <li><strong>Time Savings:</strong> Pre-designed layouts eliminate the need to create invoices from scratch</li>
                <li><strong>Consistency:</strong> Standardized formats ensure all your invoices maintain a professional appearance</li>
                <li><strong>Compliance:</strong> Templates often include required legal elements and tax information</li>
                <li><strong>Customization:</strong> Easy to modify with your branding, colors, and business information</li>
                <li><strong>Cost-Effective:</strong> Free templates provide professional results without software costs</li>
            </ul>
            
            <h3>Essential Elements of a Professional Invoice</h3>
            <p>Every effective invoice template should include these critical components:</p>
            <ul>
                <li>Clear business branding and contact information</li>
                <li>Unique invoice number for tracking</li>
                <li>Invoice and due dates</li>
                <li>Detailed description of goods or services</li>
                <li>Itemized pricing and totals</li>
                <li>Payment terms and methods</li>
                <li>Tax information where applicable</li>
            </ul>
            
            <h3>Choosing the Right Template for Your Business</h3>
            <p>Different businesses have different invoicing needs. Consider these factors when selecting a template:</p>
            <ul>
                <li><strong>Industry Requirements:</strong> Some industries have specific invoicing standards</li>
                <li><strong>Business Size:</strong> Simple templates work for freelancers, while larger businesses may need more detailed formats</li>
                <li><strong>Client Expectations:</strong> B2B clients often expect more formal invoices than individual consumers</li>
                <li><strong>Payment Methods:</strong> Ensure your template accommodates your preferred payment options</li>
            </ul>
            
            <h3>Customizing Your Invoice Template</h3>
            <p>To maximize the impact of your invoice template:</p>
            <ul>
                <li>Add your logo and brand colors</li>
                <li>Include your business registration details</li>
                <li>Customize payment terms to match your business model</li>
                <li>Add personalized thank-you messages</li>
                <li>Include links to your website or social media</li>
            </ul>
            
            <h3>Digital vs. Printable Templates</h3>
            <p>Modern businesses need templates that work both digitally and in print. Digital templates offer advantages like:</p>
            <ul>
                <li>Instant delivery via email</li>
                <li>Clickable payment links</li>
                <li>Automatic calculations</li>
                <li>Easy storage and organization</li>
                <li>Environmental benefits</li>
            </ul>
            
            <h3>Best Practices for Invoice Template Usage</h3>
            <p>To get the most from your invoice templates:</p>
            <ul>
                <li>Send invoices promptly after completing work</li>
                <li>Use clear, descriptive language for services</li>
                <li>Include all necessary contact information</li>
                <li>Set up automated reminders for overdue payments</li>
                <li>Keep detailed records of all invoices sent</li>
            </ul>
            
            <h2>Transform Your Billing with FanyaBill</h2>
            <p>While free templates are a great starting point, modern businesses can benefit from AI-powered invoicing solutions. <a href="https://fanyabill.site/">FanyaBill</a> combines the convenience of templates with intelligent automation, helping you create professional invoices in seconds while tracking inventory and managing customer relationships.</p>
            
            <p>Ready to revolutionize your invoicing process? Start with a free template today, and when you're ready to scale, explore how FanyaBill can take your business to the next level.</p>
        `,
        tags: ['invoice templates', 'business', 'billing', 'free tools', 'professional invoicing']
    },
    'invoice-generator-guide': {
        title: 'Invoice Generator: The Ultimate Guide to Streamlined Billing',
        description: 'Learn how modern invoice generators can revolutionize your billing process with AI-powered features and automated workflows.',
        image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
        content: `
            <h2>The Evolution of Invoice Generation</h2>
            <p>Invoice generation has come a long way from manual paper invoices to sophisticated AI-powered systems. Modern invoice generators are transforming how businesses handle billing, offering unprecedented efficiency and accuracy.</p>
            
            <h3>What is an Invoice Generator?</h3>
            <p>An invoice generator is a digital tool that automates the creation of professional invoices. These platforms combine templates, automation, and often AI technology to streamline the entire billing process from creation to payment collection.</p>
            
            <h3>Key Features of Modern Invoice Generators</h3>
            <ul>
                <li><strong>Automated Calculations:</strong> Eliminate math errors with automatic tax and total calculations</li>
                <li><strong>Template Library:</strong> Access to professionally designed invoice templates</li>
                <li><strong>Client Management:</strong> Store and manage customer information</li>
                <li><strong>Payment Integration:</strong> Accept payments directly through invoices</li>
                <li><strong>Tracking and Reporting:</strong> Monitor invoice status and generate financial reports</li>
                <li><strong>Multi-Currency Support:</strong> Handle international clients with ease</li>
            </ul>
            
            <h3>Benefits of Using an Invoice Generator</h3>
            <p>Businesses that switch to invoice generators typically see immediate improvements in:</p>
            <ul>
                <li>Time efficiency - Create invoices in minutes, not hours</li>
                <li>Accuracy - Reduce human errors in calculations</li>
                <li>Cash flow - Faster invoice delivery and payment processing</li>
                <li>Professionalism - Consistent, branded invoice appearance</li>
                <li>Organization - Better record keeping and financial tracking</li>
            </ul>
            
            <h3>AI-Powered Invoice Generation</h3>
            <p>The latest generation of invoice tools incorporates artificial intelligence to make billing even more efficient. AI features include:</p>
            <ul>
                <li>Natural language processing for item description</li>
                <li>Automatic client information population</li>
                <li>Smart payment term suggestions</li>
                <li>Predictive analytics for cash flow forecasting</li>
                <li>Automated follow-up scheduling</li>
            </ul>
            
            <h2>Choosing the Right Invoice Generator</h2>
            <p>When selecting an invoice generator, consider factors like ease of use, integration capabilities, pricing, and specific features that match your business needs. <a href="https://fanyabill.site/">FanyaBill</a> offers a comprehensive solution that combines AI-powered generation with inventory management and business analytics.</p>
        `,
        tags: ['invoice generator', 'automation', 'business tools', 'efficiency', 'AI invoicing']
    },
    'professional-invoice-design': {
        title: 'Free Invoice Template: Make Your Business Look Professional',
        description: 'Transform your business image with professionally designed invoice templates that build trust and encourage faster payments.',
        image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
        content: `
            <h2>The Impact of Professional Invoice Design</h2>
            <p>Your invoice is often the final touchpoint in a business transaction. A professionally designed invoice not only facilitates payment but also reinforces your brand and builds client confidence in your business.</p>
            
            <h3>Elements of Professional Invoice Design</h3>
            <p>Professional invoices share several key design characteristics:</p>
            <ul>
                <li><strong>Clean Layout:</strong> Organized information hierarchy with plenty of white space</li>
                <li><strong>Brand Consistency:</strong> Incorporation of your logo, colors, and fonts</li>
                <li><strong>Clear Typography:</strong> Easy-to-read fonts and appropriate sizing</li>
                <li><strong>Logical Flow:</strong> Information presented in a logical, scannable format</li>
                <li><strong>Professional Color Scheme:</strong> Colors that convey trust and professionalism</li>
            </ul>
            
            <h3>Building Trust Through Design</h3>
            <p>Professional invoice design builds trust by:</p>
            <ul>
                <li>Demonstrating attention to detail</li>
                <li>Showing business legitimacy</li>
                <li>Creating a memorable brand experience</li>
                <li>Facilitating easy payment processing</li>
                <li>Reducing client confusion or questions</li>
            </ul>
            
            <h3>Free vs. Premium Templates</h3>
            <p>While free templates provide an excellent starting point, consider upgrading to premium solutions when your business grows. Premium tools like <a href="https://fanyabill.site/">FanyaBill</a> offer advanced customization, automation, and integration features that can significantly improve your billing efficiency.</p>
        `,
        tags: ['professional design', 'branding', 'invoice templates', 'business image', 'trust building']
    },
    'invoice-customers-seconds': {
        title: 'Invoice Your Customers in Seconds with Modern Technology',
        description: 'Discover how AI-powered invoicing tools can help you create and send professional invoices in seconds, not hours.',
        image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
        content: `
            <h2>The Speed Revolution in Invoicing</h2>
            <p>Modern technology has transformed invoicing from a time-consuming administrative task into a lightning-fast process. With the right tools, you can create and send professional invoices in seconds, not hours.</p>
            
            <h3>How AI Accelerates Invoice Creation</h3>
            <p>Artificial intelligence streamlines invoicing through:</p>
            <ul>
                <li>Natural language processing for quick item entry</li>
                <li>Automatic client information retrieval</li>
                <li>Smart calculation and tax handling</li>
                <li>Instant PDF generation and delivery</li>
                <li>Automated follow-up scheduling</li>
            </ul>
            
            <h3>The Business Impact of Fast Invoicing</h3>
            <p>Quick invoicing capabilities provide several business advantages:</p>
            <ul>
                <li><strong>Improved Cash Flow:</strong> Faster invoicing leads to faster payments</li>
                <li><strong>Increased Productivity:</strong> More time for core business activities</li>
                <li><strong>Better Client Relationships:</strong> Prompt, professional billing builds trust</li>
                <li><strong>Reduced Errors:</strong> Automation minimizes human mistakes</li>
                <li><strong>Scalability:</strong> Handle more clients without proportional time increase</li>
            </ul>
            
            <h3>Real-World Speed Comparison</h3>
            <p>Traditional invoicing methods vs. modern AI-powered solutions:</p>
            <ul>
                <li>Manual creation: 15-30 minutes per invoice</li>
                <li>Template-based: 5-10 minutes per invoice</li>
                <li>AI-powered tools: 30 seconds to 2 minutes per invoice</li>
            </ul>
            
            <h2>Experience Lightning-Fast Invoicing</h2>
            <p>Ready to transform your billing process? <a href="https://fanyabill.site/">FanyaBill's AI-powered invoice generator</a> can help you create professional invoices in seconds. Simply describe your sale in natural language, and watch as AI generates a complete, professional invoice ready for delivery.</p>
        `,
        tags: ['AI invoicing', 'speed', 'automation', 'modern business', 'efficiency']
    }
};

// DOM Content Loaded
document.addEventListener('DOMContentLoaded', function() {
    loadArticle();
    setupArticleFeatures();
});

// Load article content based on URL parameter
function loadArticle() {
    const urlParams = new URLSearchParams(window.location.search);
    const articleId = urlParams.get('id');
    
    if (!articleId || !articleContent[articleId]) {
        // Redirect to blog if article not found
        window.location.href = 'blog.html';
        return;
    }
    
    const article = articleContent[articleId];
    
    // Update page title and meta
    document.title = `${article.title} - FanyaBill Blog`;
    document.getElementById('articleTitle').textContent = article.title;
    document.getElementById('articleDescription').setAttribute('content', article.description);
    
    // Update article content
    document.getElementById('articleBreadcrumb').textContent = article.title;
    document.getElementById('articleHeading').textContent = article.title;
    document.getElementById('articleDate').textContent = formatDate(new Date());
    document.getElementById('articleReadTime').textContent = calculateReadTime(article.content);
    document.getElementById('articleImage').src = article.image;
    document.getElementById('articleImage').alt = article.title;
    document.getElementById('articleBody').innerHTML = article.content;
    
    // Load tags
    loadArticleTags(article.tags);
    
    // Generate table of contents
    generateTableOfContents();
    
    // Load related articles
    loadRelatedArticles(articleId);
    
    // Load more articles
    loadMoreArticles();
}

// Setup article-specific features
function setupArticleFeatures() {
    // Newsletter form
    const sidebarNewsletterForm = document.getElementById('sidebarNewsletterForm');
    if (sidebarNewsletterForm) {
        sidebarNewsletterForm.addEventListener('submit', handleSidebarNewsletterSubmit);
    }
    
    // Smooth scrolling for TOC links
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('toc-link')) {
            e.preventDefault();
            const targetId = e.target.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        }
    });
    
    // Update active TOC item on scroll
    window.addEventListener('scroll', updateActiveTOCItem);
}

// Load article tags
function loadArticleTags(tags) {
    const tagsContainer = document.getElementById('articleTags');
    if (!tagsContainer || !tags) return;
    
    tagsContainer.innerHTML = '';
    tags.forEach(tag => {
        const tagElement = document.createElement('a');
        tagElement.href = `blog.html?search=${encodeURIComponent(tag)}`;
        tagElement.className = 'tag';
        tagElement.textContent = tag;
        tagsContainer.appendChild(tagElement);
    });
}

// Generate table of contents
function generateTableOfContents() {
    const tocContainer = document.getElementById('tableOfContents');
    const articleBody = document.getElementById('articleBody');
    
    if (!tocContainer || !articleBody) return;
    
    const headings = articleBody.querySelectorAll('h2, h3');
    if (headings.length === 0) {
        tocContainer.innerHTML = '<p>No sections found</p>';
        return;
    }
    
    const tocList = document.createElement('ul');
    tocList.className = 'toc';
    
    headings.forEach((heading, index) => {
        // Create unique ID for heading
        const headingId = `heading-${index}`;
        heading.id = headingId;
        
        // Create TOC item
        const tocItem = document.createElement('li');
        const tocLink = document.createElement('a');
        tocLink.href = `#${headingId}`;
        tocLink.className = 'toc-link';
        tocLink.textContent = heading.textContent;
        
        if (heading.tagName === 'H3') {
            tocLink.style.paddingLeft = '1rem';
            tocLink.style.fontSize = '0.9rem';
        }
        
        tocItem.appendChild(tocLink);
        tocList.appendChild(tocItem);
    });
    
    tocContainer.appendChild(tocList);
}

// Update active TOC item based on scroll position
function updateActiveTOCItem() {
    const tocLinks = document.querySelectorAll('.toc-link');
    const headings = document.querySelectorAll('#articleBody h2, #articleBody h3');
    
    let activeHeading = null;
    const scrollPosition = window.scrollY + 100;
    
    headings.forEach(heading => {
        if (heading.offsetTop <= scrollPosition) {
            activeHeading = heading;
        }
    });
    
    // Update active state
    tocLinks.forEach(link => link.classList.remove('active'));
    
    if (activeHeading) {
        const activeLink = document.querySelector(`.toc-link[href="#${activeHeading.id}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }
}

// Load related articles
function loadRelatedArticles(currentArticleId) {
    const relatedContainer = document.getElementById('relatedArticles');
    if (!relatedContainer) return;
    
    // Get articles from blog.js if available
    const articles = window.blogFunctions?.blogArticles || [];
    const relatedArticles = articles
        .filter(article => article.id !== currentArticleId)
        .slice(0, 3);
    
    if (relatedArticles.length === 0) {
        relatedContainer.innerHTML = '<p>No related articles found</p>';
        return;
    }
    
    relatedContainer.innerHTML = '';
    relatedArticles.forEach(article => {
        const relatedItem = createRelatedArticleItem(article);
        relatedContainer.appendChild(relatedItem);
    });
}

// Create related article item
function createRelatedArticleItem(article) {
    const item = document.createElement('div');
    item.className = 'related-article';
    
    item.innerHTML = `
        <div class="related-article-image">
            <img src="${article.image}" alt="${article.title}" loading="lazy">
        </div>
        <div class="related-article-content">
            <a href="article.html?id=${article.id}">
                <h5>${article.title}</h5>
            </a>
            <div class="related-article-meta">
                ${formatDate(article.date)} • ${article.readTime}
            </div>
        </div>
    `;
    
    return item;
}

// Load more articles for bottom section
function loadMoreArticles() {
    const moreArticlesGrid = document.getElementById('moreArticlesGrid');
    if (!moreArticlesGrid) return;
    
    // Get articles from blog.js if available
    const articles = window.blogFunctions?.blogArticles || [];
    const moreArticles = articles.slice(0, 3);
    
    moreArticlesGrid.innerHTML = '';
    moreArticles.forEach(article => {
        const articleCard = createSimpleArticleCard(article);
        moreArticlesGrid.appendChild(articleCard);
    });
}

// Create simple article card for more articles section
function createSimpleArticleCard(article) {
    const card = document.createElement('div');
    card.className = 'article-card';
    
    card.innerHTML = `
        <div class="article-card-image">
            <img src="${article.image}" alt="${article.title}" loading="lazy">
        </div>
        <div class="article-card-content">
            <span class="article-card-category">${getCategoryDisplayName(article.category)}</span>
            <h3>${article.title}</h3>
            <p>${article.excerpt}</p>
            <div class="article-meta">
                <span class="author">${article.author}</span>
                <span class="date">${formatDate(article.date)}</span>
                <span class="read-time">${article.readTime}</span>
            </div>
            <a href="article.html?id=${article.id}" class="read-more-btn">
                Read More <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    `;
    
    return card;
}

// Social sharing functions
function shareOnTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(document.title);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareOnFacebook() {
    const url = encodeURIComponent(window.location.href);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnLinkedIn() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}`, '_blank');
}

function copyArticleLink() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        // Show success message
        const copyBtn = document.querySelector('.share-btn.copy');
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => {
            copyBtn.innerHTML = originalText;
        }, 2000);
    });
}

// Handle sidebar newsletter form submission
async function handleSidebarNewsletterSubmit(e) {
    e.preventDefault();
    
    const email = e.target.querySelector('input[type="email"]').value;
    const button = e.target.querySelector('button');
    const originalText = button.textContent;
    
    // Show loading state
    button.textContent = 'Subscribing...';
    button.disabled = true;
    
    try {
        // Simulate API call (replace with actual endpoint)
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Show success
        button.textContent = 'Subscribed!';
        e.target.querySelector('input[type="email"]').value = '';
        
        // Reset after 3 seconds
        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
        }, 3000);
        
    } catch (error) {
        console.error('Newsletter subscription error:', error);
        button.textContent = 'Error - Try Again';
        
        // Reset after 3 seconds
        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
        }, 3000);
    }
}

// Utility functions
function formatDate(date) {
    if (typeof date === 'string') {
        date = new Date(date);
    }
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

function calculateReadTime(content) {
    const wordsPerMinute = 200;
    const wordCount = content.split(/\s+/).length;
    const readTime = Math.ceil(wordCount / wordsPerMinute);
    return `${readTime} min read`;
}

function getCategoryDisplayName(category) {
    const categoryMap = {
        'invoicing': 'Invoicing',
        'business-tips': 'Business Tips',
        'templates': 'Templates',
        'ai-tools': 'AI Tools'
    };
    return categoryMap[category] || category;
}

